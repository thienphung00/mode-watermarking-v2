# Runtime configuration for watermarking service
# Based on: experiments/watermark_ablation/configs/baseline_binary_bandpass_mid.yaml
# Key family: experiments/watermark_ablation/family_043.json

# Model configuration
model:
  default_model_id: "runwayml/stable-diffusion-v1-5"
  device: "cuda"  # or "cpu"
  use_fp16: true

# Watermark algorithm configuration
watermark:
  mode: "watermarked"
  key_id: "ablation_baseline_binary_bandpass_mid"

# G-field configuration (must match generation/detection)
g_field:
  shape: [4, 64, 64]
  mapping_mode: "binary"
  continuous_range: [-1.0, 1.0]
  channel_wise: true
  domain: "frequency"
  frequency_mode: "bandpass"
  low_freq_cutoff: 0.05
  high_freq_cutoff: 0.4
  frequency_normalization: "parseval"
  normalize:
    enable: true
    zero_mean_per_timestep: true
    zero_mean_per_channel: true
    unit_variance: false
    eps: 1.0e-08

# Mask configuration
mask:
  mode: "frequency"
  strength: 0.9
  band: "bandpass"
  cutoff_freq: 0.5
  bandwidth_fraction: 0.25
  shape: "radial"
  radius_fraction: 0.5

# Bias configuration
bias:
  mode: "non_distortionary"
  target_snr: 0.05
  alpha_bounds: [0.0, 0.08]
  min_strength: 0.005
  max_strength: 0.025
  injection:
    strategy: "concentrated_late"
    start_fraction: 0.7
    peak_fraction: 0.9
    end_fraction: 1.0
    shape: "triangular"
    normalize_alpha: true
  content_hash_strength: 0.3
  time_dependent_offset: false

# Seed bias configuration
seed_bias:
  lambda_strength: 0.075
  domain: "frequency"
  low_freq_cutoff: 0.05
  high_freq_cutoff: 0.4
  mask_config: null

# PRF configuration
prf:
  algorithm: "chacha20"
  output_bits: 64

# Diffusion configuration
diffusion:
  model_id: "runwayml/stable-diffusion-v1-5"
  trained_timesteps: 1000
  inference_timesteps: 50
  beta_start: 0.00085
  beta_end: 0.012
  beta_schedule: "linear"
  prediction_type: "epsilon"
  scheduler: "DDIM"
  scheduler_kwargs: {}
  guidance_scale: 7.5
  gradient_checkpointing: false

# Detection configuration
detection:
  mode: "bayesian"
  num_inference_steps: 50
  threshold: 0.5
  prior_watermarked: 0.5
  # Calibration from family_043.json (1940 positions)
  num_positions: 1940

# Storage
storage:
  key_db_path: "service_data/watermark_keys.json"

# Security
security:
  encryption_key_env: "WATERMARK_ENCRYPTION_KEY"  # Set in production

# Logging
logging:
  level: "INFO"
